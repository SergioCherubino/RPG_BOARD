<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RPG Board 30x30</title>
<style>
  body {
    background: #1b1b1b;
    color: white;
    font-family: Arial;
  }

  #board {
    display: grid;
    grid-template-columns: repeat(30, 20px);
    grid-template-rows: repeat(30, 20px);
    gap: 1px;
    margin-bottom: 20px;
  }

  .tile {
    width: 20px;
    height: 20px;
    box-sizing: border-box;
  }

  .room {
    background: #6b6b6b;
    border: 1px solid #515151;
  }

  .corridor {
    background: #4d4d4d;
    border: 1px solid #3a3a3a;
  }

  .door {
    background: #d4b645;
    border: 1px solid #ffe38c;
  }

  .door.debug::after {
    content: "D";
    color: red;
    font-weight: bold;
    position: absolute;
  }

  button {
    padding: 10px 20px;
    font-size: 16px;
  }
</style>
</head>
<body>

<h2>Dungeon Limpinha – Somente Corredores Necessários</h2>
<button onclick="toggleDoors()">Mostrar Portas</button>

<div id="board"></div>

<script>
const SIZE = 30;
const board = document.getElementById("board");

let grid = Array.from({ length: SIZE }, () => Array(SIZE).fill("empty"));
let rooms = [];
let showDoorsFlag = false;

/* =====================================================
                 GERAR SALAS
===================================================== */
function generateRooms() {
  const roomCount = 10 + Math.floor(Math.random() * 7);

  for (let i = 0; i < roomCount; i++) {
    let w = 2 + Math.floor(Math.random() * 4);
    let h = 2 + Math.floor(Math.random() * 4);

    let x = Math.floor(Math.random() * (SIZE - w - 1));
    let y = Math.floor(Math.random() * (SIZE - h - 1));

    if (!roomFits(x, y, w, h)) continue;

    drawRoom(x, y, w, h);
    rooms.push({ x, y, w, h, cx: Math.floor(x + w / 2), cy: Math.floor(y + h / 2) });
  }
}

function roomFits(x, y, w, h) {
  for (let j = y; j < y + h; j++)
    for (let i = x; i < x + w; i++)
      if (grid[j][i] !== "empty") return false;
  return true;
}

function drawRoom(x, y, w, h) {
  for (let j = y; j < y + h; j++)
    for (let i = x; i < x + w; i++)
      grid[j][i] = "room";
}

/* =====================================================
       CONECTAR SALAS USANDO ÁRVORE GERADORA MÍNIMA
===================================================== */
function connectRooms() {
  if (rooms.length < 2) return;

  // Montar todas as distâncias entre salas
  let edges = [];
  for (let i = 0; i < rooms.length; i++) {
    for (let j = i + 1; j < rooms.length; j++) {
      let a = rooms[i];
      let b = rooms[j];
      let dist = Math.abs(a.cx - b.cx) + Math.abs(a.cy - b.cy);
      edges.push({ a: i, b: j, dist });
    }
  }

  // Ordenar por menor distância
  edges.sort((a, b) => a.dist - b.dist);

  // Kruskal básico
  let parent = [];
  for (let i = 0; i < rooms.length; i++) parent[i] = i;

  function find(x) { return parent[x] === x ? x : parent[x] = find(parent[x]); }
  function union(a, b) { parent[find(a)] = find(b); }

  for (let e of edges) {
    if (find(e.a) !== find(e.b)) {
      union(e.a, e.b);
      carveCorridor(rooms[e.a], rooms[e.b]);
    }
  }
}

/* =====================================================
          CRIAR CORREDOR ESTILO L-SHAPED
===================================================== */
function carveCorridor(A, B) {
  let x = A.cx;
  let y = A.cy;

  // Caminho horizontal até o B.cx
  let stepX = x < B.cx ? 1 : -1;
  while (x !== B.cx) {
    if (grid[y][x] === "empty") grid[y][x] = "corridor";
    x += stepX;
  }

  // Caminho vertical até o B.cy
  let stepY = y < B.cy ? 1 : -1;
  while (y !== B.cy) {
    if (grid[y][x] === "empty") grid[y][x] = "corridor";
    y += stepY;
  }

  createDoor(A, B);
}

/* =====================================================
                     CRIAR PORTAS
===================================================== */
function createDoor(A, B) {
  // portas no tile onde corredor toca piso da sala

  placeDoorAt(A.cx, A.cy);
  placeDoorAt(B.cx, B.cy);
}

function placeDoorAt(cx, cy) {
  let dirs = [
    [1,0],[-1,0],[0,1],[0,-1]
  ];

  for (let [dx,dy] of dirs) {
    let x = cx + dx;
    let y = cy + dy;
    if (x<0||y<0||x>=SIZE||y>=SIZE) continue;

    if (grid[y][x] === "corridor") {
      grid[cy][cx] = "door";
      return;
    }
  }
}

/* =====================================================
                     RENDERIZAÇÃO
===================================================== */
function render() {
  board.innerHTML = "";

  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {

      let div = document.createElement("div");
      div.classList.add("tile");

      if (grid[y][x] !== "empty")
        div.classList.add(grid[y][x]);

      if (grid[y][x] === "door" && showDoorsFlag)
        div.classList.add("debug");

      board.appendChild(div);
    }
  }
}

function toggleDoors() {
  showDoorsFlag = !showDoorsFlag;
  render();
}

/* =====================================================
                        EXECUTAR
===================================================== */

generateRooms();
connectRooms();
render();

</script>
</body>
</html>
